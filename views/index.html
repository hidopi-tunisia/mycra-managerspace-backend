<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Test</title>
  </head>
  <body>
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js'
      const firebaseConfig = {
        apiKey: 'AIzaSyAtbcfR9X35EzSnXvBnof6JtSzkg6n-FPc',
        authDomain: 'mycra-dev.firebaseapp.com',
        projectId: 'mycra-dev',
        storageBucket: 'mycra-dev.appspot.com',
        messagingSenderId: '474737003844',
        appId: '1:474737003844:web:29df8548ab6c9915cd5b11',
        measurementId: 'G-T6VZS6SR76',
      }

      // Initialize Firebase
      const app = initializeApp(firebaseConfig)
    </script>

    <script type="module">
      import { createApp } from 'https://unpkg.com/petite-vue?module'
      import {
        getAuth,
        signInWithEmailAndPassword,
        connectAuthEmulator,
        createUserWithEmailAndPassword,
      } from 'https://www.gstatic.com/firebasejs/9.5.0/firebase-auth.js'

      function MyApp() {
        return {
          auth: null,
          email: '',
          password: '',
          user: null,
          str: '',
          role: '',
          mounted() {
            this.auth = getAuth()
          },
          handleClickSignIn() {
            this.str = ''
            this.role = ''
            signInWithEmailAndPassword(this.auth, this.email, this.password)
              .then(({ user }) => {
                this.user = user
                this.str = JSON.stringify(user, null, 2)
                this.auth.currentUser
                  .getIdTokenResult()
                  .then((token) => {
                    if (token.claims && token.claims.role) {
                      this.role = token.claims.role
                    }
                  })
                  .catch((error) => {
                    console.log(error)
                  })
              })
              .catch((error) => {
                console.log(error)
                const errorCode = error.code
                const errorMessage = error.message
              })
          },
          handleClickCopyAuthorization() {
            navigator.clipboard.writeText(this.user.accessToken)
          },
        }
      }
      createApp({
        MyApp,
      }).mount()
    </script>
    <div v-scope="MyApp()" @vue:mounted="mounted">
      <div class="row bg-info">
        <div class="col-md-4 mx-auto my-5">
          <div class="form-group">
            <label for="exampleInputEmail1">Email</label>
            <input
              type="text"
              class="form-control"
              id="exampleInputEmail1"
              aria-describedby="emailHelp"
              placeholder="Enter email"
              v-model="email"
            />
          </div>
          <div class="form-group">
            <label for="exampleInputPassword1">Password</label>
            <input
              type="password"
              class="form-control"
              id="exampleInputPassword1"
              placeholder="Password"
              v-model="password"
            />
          </div>
          <button
            type="button"
            class="btn btn-primary mt-2"
            @click="handleClickSignIn()"
          >
            Sign In
          </button>
        </div>
      </div>
      <div class="row bg-success" v-if="user">
        <div class="col-md-4 mx-auto my-5">
          <div>
            <textarea v-model="str"></textarea>
          </div>
          <div>
            <button
              class="btn btn-info"
              @click="handleClickCopyAuthorization()"
            >
              Copy authorization
            </button>
            <span class="bg-info">
              Role: {{role}}
            </span>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
